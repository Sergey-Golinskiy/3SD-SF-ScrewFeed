<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Панель керування відкруткою</title>
    <link rel="stylesheet" href="/static/css/style.css?v=1.0.16">
</head>
<body>
    <div class="app">
        <!-- Header -->
        <header class="header">
            <h1>Панель керування відкруткою</h1>
            <div class="header-right">
                <span class="version">v1.0.16</span>
                <div class="status-indicator" id="connectionStatus">
                    <span class="dot"></span>
                    <span class="text">Підключення...</span>
                </div>
            </div>
        </header>

        <!-- Tab Navigation -->
        <nav class="tabs">
            <button class="tab-btn active" data-tab="status">Статус</button>
            <button class="tab-btn" data-tab="control">Керування</button>
            <button class="tab-btn" data-tab="xy">XY Стіл</button>
            <button class="tab-btn" data-tab="settings">Налаштування</button>
        </nav>

        <!-- Tab Content -->
        <main class="tab-content">
            <!-- Status Tab -->
            <section id="status" class="tab-panel active">
                <div class="grid-2">
                    <!-- Cycle Status -->
                    <div class="card">
                        <h2>Cycle Status</h2>
                        <div class="status-grid">
                            <div class="status-item">
                                <span class="label">State</span>
                                <span class="value" id="cycleState">-</span>
                            </div>
                            <div class="status-item">
                                <span class="label">Device</span>
                                <span class="value" id="currentDevice">-</span>
                            </div>
                            <div class="status-item">
                                <span class="label">Progress</span>
                                <span class="value" id="cycleProgress">0 / 0</span>
                            </div>
                            <div class="status-item">
                                <span class="label">Cycles</span>
                                <span class="value" id="cycleCount">0</span>
                            </div>
                        </div>
                    </div>

                    <!-- XY Table Status -->
                    <div class="card">
                        <h2>XY Table</h2>
                        <div class="status-grid">
                            <div class="status-item">
                                <span class="label">Status</span>
                                <span class="value" id="xyState">-</span>
                            </div>
                            <div class="status-item">
                                <span class="label">Position</span>
                                <span class="value" id="xyPosition">X: 0.00 Y: 0.00</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sensors -->
                <div class="card">
                    <h2>Sensors</h2>
                    <div class="sensor-grid" id="sensorGrid">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Relays -->
                <div class="card">
                    <h2>Relays</h2>
                    <div class="relay-grid" id="relayGrid">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </section>

            <!-- Control Tab -->
            <section id="control" class="tab-panel">
                <div class="card">
                    <h2>Cycle Control</h2>
                    <div class="control-row">
                        <select id="deviceSelect" class="input-select">
                            <option value="">-- Select Device --</option>
                        </select>
                        <button class="btn btn-info" id="btnInit">ІНІЦІАЛІЗАЦІЯ</button>
                        <button class="btn btn-primary" id="btnCycleStart" disabled>START</button>
                        <button class="btn btn-danger" id="btnCycleStop">STOP</button>
                        <button class="btn btn-warning" id="btnCyclePause">PAUSE</button>
                    </div>
                </div>

                <!-- Initialization Status Card -->
                <div class="card" id="initStatusCard" style="display: none;">
                    <h2>Статус ініціалізації</h2>
                    <div id="initStatusText" class="init-status-text">-</div>
                    <div class="init-progress">
                        <div class="init-progress-bar" id="initProgressBar"></div>
                    </div>
                </div>

                <div class="card">
                    <h2>Emergency</h2>
                    <div class="control-row">
                        <button class="btn btn-danger btn-large" id="btnEstop">E-STOP</button>
                        <button class="btn btn-secondary" id="btnClearEstop">Clear E-STOP</button>
                    </div>
                </div>

                <div class="card">
                    <h2>Relay Manual Control</h2>
                    <div class="relay-control-grid" id="relayControlGrid">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </section>

            <!-- XY Table Tab -->
            <section id="xy" class="tab-panel">
                <!-- XY Table Connection Status -->
                <div class="card xy-connection-card">
                    <h2>XY Table - Статус підключення</h2>
                    <div class="xy-connection-grid">
                        <div class="xy-conn-item">
                            <span class="label">Сервіс:</span>
                            <span class="value" id="xyServiceStatus">-</span>
                        </div>
                        <div class="xy-conn-item">
                            <span class="label">Підключення:</span>
                            <span class="value" id="xyConnStatus">-</span>
                        </div>
                        <div class="xy-conn-item">
                            <span class="label">Стан:</span>
                            <span class="value" id="xyStateDisplay">-</span>
                        </div>
                        <div class="xy-conn-item">
                            <span class="label">Пінг:</span>
                            <span class="value" id="xyPingLatency">- ms</span>
                        </div>
                        <div class="xy-conn-item">
                            <span class="label">Endstop X:</span>
                            <span class="value" id="xyEndstopX">-</span>
                        </div>
                        <div class="xy-conn-item">
                            <span class="label">Endstop Y:</span>
                            <span class="value" id="xyEndstopY">-</span>
                        </div>
                        <div class="xy-conn-item xy-conn-warning" id="xyLimitWarningRow" style="display: none;">
                            <span class="label">Ліміт:</span>
                            <span class="value" id="xyLimitWarning">-</span>
                        </div>
                        <div class="xy-conn-item xy-conn-error">
                            <span class="label">Помилка:</span>
                            <span class="value" id="xyLastError">-</span>
                        </div>
                    </div>
                    <div class="xy-conn-buttons">
                        <button class="btn btn-primary" id="btnXYConnect">Підключити</button>
                        <button class="btn btn-secondary" id="btnXYDisconnect">Відключити</button>
                        <button class="btn btn-secondary" id="btnXYPing">Ping</button>
                    </div>
                </div>

                <div class="grid-2">
                    <div class="card">
                        <h2>Позиція</h2>
                        <div class="xy-position">
                            <span class="xy-coord xy-coord-physical" id="xyPosDisplay">X: 0.00  Y: 0.00</span>
                            <span class="xy-coord-label">фізичні координати</span>
                        </div>
                        <div class="xy-position xy-position-work">
                            <span class="xy-coord xy-coord-work" id="xyPosWorkDisplay">X: 0.00  Y: 0.00</span>
                            <span class="xy-coord-label">робочі координати (зі зміщенням)</span>
                        </div>
                        <div class="xy-homed-status">
                            <span class="homed-indicator" id="xyHomedX">X: не захомлено</span>
                            <span class="homed-indicator" id="xyHomedY">Y: не захомлено</span>
                        </div>
                        <div class="xy-estop-indicator" id="xyEstopIndicator" style="display: none;">
                            <span class="estop-warning">⚠️ АВАРІЙНА ЗУПИНКА! Потрібна калібрування.</span>
                        </div>
                    </div>

                    <div class="card">
                        <h2>Jog Control</h2>
                        <div class="jog-grid">
                            <div></div>
                            <button class="btn btn-jog btn-jog-y" data-jog="y-">Y-</button>
                            <div></div>
                            <button class="btn btn-jog btn-jog-x" data-jog="x+">X+</button>
                            <button class="btn btn-jog btn-home" id="btnXYHome">⌂</button>
                            <button class="btn btn-jog btn-jog-x" data-jog="x-">X-</button>
                            <div></div>
                            <button class="btn btn-jog btn-jog-y" data-jog="y+">Y+</button>
                            <div></div>
                        </div>
                        <div class="jog-step">
                            <label>Step:</label>
                            <select id="jogStep" class="input-select">
                                <option value="0.1">0.1 mm</option>
                                <option value="0.5">0.5 mm</option>
                                <option value="1">1 mm</option>
                                <option value="5">5 mm</option>
                                <option value="10" selected>10 mm</option>
                                <option value="50">50 mm</option>
                                <option value="100">100 mm</option>
                            </select>
                            <label>Feed:</label>
                            <select id="jogFeed" class="input-select">
                                <option value="1000">1000 mm/min</option>
                                <option value="3000">3000 mm/min</option>
                                <option value="5000" selected>5000 mm/min</option>
                                <option value="10000">10000 mm/min</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 3-column grid: Move To, Offset, Quick Actions -->
                <div class="grid-3">
                    <!-- Move To Position -->
                    <div class="card">
                        <h2>Move To Position</h2>
                        <div class="move-form-compact">
                            <div class="input-group">
                                <label>Координати:</label>
                                <select id="moveCoordType" class="input-select">
                                    <option value="physical">Фізичні</option>
                                    <option value="work">Робочі (зі зміщенням)</option>
                                </select>
                            </div>
                            <div class="form-inputs">
                                <div class="input-group">
                                    <label>X (мм):</label>
                                    <input type="number" id="moveX" class="input-number" value="0" step="0.1">
                                </div>
                                <div class="input-group">
                                    <label>Y (мм):</label>
                                    <input type="number" id="moveY" class="input-number" value="0" step="0.1">
                                </div>
                            </div>
                            <div class="input-group">
                                <label>Feed (мм/хв):</label>
                                <input type="number" id="moveFeed" class="input-number" value="10000">
                            </div>
                            <button class="btn btn-primary" id="btnMoveTo">GO</button>
                        </div>
                    </div>

                    <!-- Work Offset (G92-like) -->
                    <div class="card">
                        <h2>Робочий офсет</h2>
                        <div class="offset-form-compact">
                            <div class="form-inputs">
                                <div class="input-group">
                                    <label>Офсет X:</label>
                                    <input type="number" id="offsetX" class="input-number" value="0" step="0.1">
                                </div>
                                <div class="input-group">
                                    <label>Офсет Y:</label>
                                    <input type="number" id="offsetY" class="input-number" value="0" step="0.1">
                                </div>
                            </div>
                            <div class="btn-row">
                                <button class="btn btn-primary" id="btnSaveOffset">Зберегти офсет</button>
                                <button class="btn btn-secondary" id="btnSetCurrentAsOffset">Поточну → нуль</button>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="card">
                        <h2>Quick Actions</h2>
                        <div class="quick-actions-compact">
                            <div class="btn-row">
                                <button class="btn btn-secondary" id="btnHomeX">Home X</button>
                                <button class="btn btn-secondary" id="btnHomeY">Home Y</button>
                            </div>
                            <div class="btn-row">
                                <button class="btn btn-secondary" id="btnZero">Go to Zero</button>
                                <button class="btn btn-secondary" id="btnEnableMotors">Enable</button>
                            </div>
                            <div class="btn-row">
                                <button class="btn btn-secondary" id="btnDisableMotors">Disable</button>
                            </div>
                            <div class="brake-controls-compact">
                                <div class="brake-item">
                                    <span class="brake-label">Гальмо X</span>
                                    <button class="btn btn-brake" id="btnBrakeX" data-brake="x">
                                        <span class="brake-status" id="brakeXStatus">--</span>
                                    </button>
                                </div>
                                <div class="brake-item">
                                    <span class="brake-label">Гальмо Y</span>
                                    <button class="btn btn-brake" id="btnBrakeY" data-brake="y">
                                        <span class="brake-status" id="brakeYStatus">--</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Settings Tab -->
            <section id="settings" class="tab-panel">
                <div class="settings-layout-new">
                    <!-- Left Column -->
                    <div class="settings-left">
                        <!-- Devices List -->
                        <div class="card">
                            <div class="card-header">
                                <h2>ДЕВАЙСИ</h2>
                                <button class="btn btn-add" id="btnNewDevice">+</button>
                            </div>
                            <div class="device-list" id="deviceList">
                                <!-- Populated by JS -->
                            </div>
                        </div>

                        <!-- XY Table Control -->
                        <div class="card">
                            <h2>XY TABLE CONTROL</h2>
                            <div class="xy-control-compact">
                                <div class="xy-pos-display xy-pos-work-settings" id="settingsXYPos">X: 0.00  Y: 0.00</div>
                                <div class="xy-pos-label-settings">робочі координати</div>
                                <div class="jog-grid-compact">
                                    <div></div>
                                    <button class="btn btn-jog-compact" data-jog-settings="y-">Y-</button>
                                    <div></div>
                                    <button class="btn btn-jog-compact" data-jog-settings="x+">X+</button>
                                    <button class="btn btn-jog-compact" data-jog-settings="y+">Y+</button>
                                    <button class="btn btn-jog-compact" data-jog-settings="x-">X-</button>
                                </div>
                                <div class="jog-step-compact">
                                    <label>Крок</label>
                                    <select id="jogStepSettings" class="input-select-sm">
                                        <option value="0.1">0.1</option>
                                        <option value="0.5">0.5</option>
                                        <option value="1">1</option>
                                        <option value="5">5</option>
                                        <option value="10" selected>10</option>
                                        <option value="50">50</option>
                                    </select>
                                    <label>Feed</label>
                                    <select id="jogFeedSettings" class="input-select-sm">
                                        <option value="1000">1000</option>
                                        <option value="3000">3000</option>
                                        <option value="5000" selected>5000</option>
                                        <option value="10000">10000</option>
                                        <option value="20000">20000</option>
                                        <option value="30000">30000</option>
                                        <option value="50000">50000</option>
                                    </select>
                                </div>
                                <div class="home-buttons">
                                    <button class="btn btn-home-sm" id="btnHomeSettings">HOME</button>
                                    <button class="btn btn-home-sm btn-home-y" id="btnHomeYSettings">HOME Y</button>
                                    <button class="btn btn-home-sm btn-home-x" id="btnHomeXSettings">HOME X</button>
                                    <button class="btn btn-home-sm btn-work-zero" id="btnWorkZeroSettings">В роб. 0</button>
                                </div>
                                <div class="brake-grid-settings">
                                    <div class="brake-cell">
                                        <span class="brake-label-top">Гальмо X:</span>
                                        <button class="btn btn-brake-grid" id="btnBrakeXSettings">
                                            <span class="brake-status" id="brakeXStatusSettings">--</span>
                                        </button>
                                    </div>
                                    <div class="brake-cell">
                                        <span class="brake-label-top">Гальмо Y:</span>
                                        <button class="btn btn-brake-grid" id="btnBrakeYSettings">
                                            <span class="brake-status" id="brakeYStatusSettings">--</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column -->
                    <div class="settings-right">
                        <!-- Movement Coordinates -->
                        <div class="card">
                            <div class="card-header">
                                <h2>КООРДИНАТИ ПЕРЕМІЩЕННЯ</h2>
                                <button class="btn btn-add" id="btnAddCoord">+</button>
                            </div>

                            <div class="coords-table">
                                <div class="coords-header-new">
                                    <span class="col-num">#</span>
                                    <span class="col-x">Координата X1</span>
                                    <span class="col-y">Координата Y1</span>
                                    <span class="col-type">Тип координати</span>
                                    <span class="col-feed">Швидкість</span>
                                    <span class="col-del"></span>
                                </div>

                                <div class="coords-list-new" id="coordsList">
                                    <!-- Populated by JS -->
                                </div>
                            </div>
                        </div>

                        <!-- Device Editor -->
                        <div class="card">
                            <h2>Редактор девайсу</h2>
                            <input type="hidden" id="editDeviceKey">

                            <div class="editor-form-new">
                                <div class="form-row-new">
                                    <div class="form-group-new">
                                        <label class="form-label">Назва</label>
                                        <input type="text" id="editName" class="input-text input-uppercase" maxlength="4" placeholder="НАЗВ">
                                    </div>
                                    <div class="form-group-new">
                                        <label class="form-label">Що крутим</label>
                                        <input type="text" id="editWhat" class="input-text" maxlength="4" placeholder="Крут">
                                    </div>
                                    <div class="form-group-new">
                                        <label class="form-label">Кількість</label>
                                        <select id="editHoles" class="input-select">
                                            <option value="" disabled selected>Виберіть...</option>
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                            <option value="5">5</option>
                                            <option value="6">6</option>
                                            <option value="7">7</option>
                                            <option value="8">8</option>
                                            <option value="9">9</option>
                                            <option value="10">10</option>
                                            <option value="11">11</option>
                                            <option value="12">12</option>
                                        </select>
                                    </div>
                                    <div class="form-group-new">
                                        <label class="form-label">Розмір</label>
                                        <select id="editScrewSize" class="input-select">
                                            <option value="" disabled selected>Виберіть...</option>
                                            <option value="M3x6">M3x6</option>
                                            <option value="M3x8">M3x8</option>
                                            <option value="M3x10">M3x10</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-row-new">
                                    <div class="form-group-new">
                                        <label class="form-label">Таска</label>
                                        <select id="editTask" class="input-select">
                                            <option value="" disabled selected>Виберіть...</option>
                                            <option value="0">0</option>
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                        </select>
                                    </div>
                                    <div class="form-group-new">
                                        <label class="form-label">Робоча X <span class="label-hint">(фіз.)</span></label>
                                        <input type="number" id="editWorkX" class="input-number" min="0" max="220" step="0.1" placeholder="0-220">
                                    </div>
                                    <div class="form-group-new">
                                        <label class="form-label">Робоча Y <span class="label-hint">(фіз.)</span></label>
                                        <input type="number" id="editWorkY" class="input-number" min="0" max="500" step="0.1" placeholder="0-500">
                                    </div>
                                    <div class="form-group-new">
                                        <label class="form-label">Швидкість</label>
                                        <input type="number" id="editWorkFeed" class="input-number" min="100" max="10000" step="100" placeholder="мм/хв">
                                    </div>
                                </div>
                                <div class="form-row-new">
                                    <div class="form-group-new form-group-buttons">
                                        <button class="btn btn-save-large" id="btnSaveDevice">Зберегти параметри</button>
                                        <button class="btn btn-cancel-large" id="btnCancelEdit">Скасувати</button>
                                    </div>
                                </div>
                            </div>
                            <button class="btn btn-danger btn-delete-device" id="btnDeleteDevice">Видалити девайс</button>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script src="/static/js/app.js?v=1.0.16"></script>
</body>
</html>
