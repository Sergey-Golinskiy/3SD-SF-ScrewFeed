# GPIO Pin Configuration for Raspberry Pi 5
# All pins use BCM numbering

# =========================
# XY Table Stepper Motors
# =========================
xy_table:
  x_axis:
    step: 9
    dir: 10
    enable: 11
    endstop: 2
  y_axis:
    step: 21
    dir: 7
    enable: 8
    endstop: 3

# =========================
# Relays (directly connected to Master Pi 5)
# NOTE: Relay pins must NOT conflict with sensor pins (17, 18, 22, 23, 12, 25)
# Relays are active_low: GPIO LOW = relay ON, GPIO HIGH = relay OFF
# =========================
relays:
  # R01 - Screw feeder (pulse to release screw)
  r01_pit:
    gpio: 5
    active_high: false
    description: "Screw feeder - pulse to release screw"
    pulse_ms: 200

  # R02 - Task 2 selection (700ms pulse)
  r02_di7_tsk2:
    gpio: 6
    active_high: false
    description: "Select task 2 for tightening (700ms pulse)"
    pulse_ms: 700

  # R04 - Cylinder control (ON=down, OFF=up automatic)
  r04_c2:
    gpio: 16
    active_high: false
    description: "Screwdriver cylinder (ON=down, OFF=up)"

  # R05 - Free run mode (hold ON = screwdriver spins)
  r05_di4_free:
    gpio: 19
    active_high: false
    description: "Free run mode - screwdriver spins while ON"

  # R06 - Torque mode (hold ON until torque OK signal)
  r06_di1_pot:
    gpio: 20
    active_high: false
    description: "Torque mode - hold ON until DO2_OK"

  # R07 - Task 0 selection (700ms pulse)
  r07_di5_tsk0:
    gpio: 21
    active_high: false
    description: "Select task 0 for tightening (700ms pulse)"
    pulse_ms: 700

  # R08 - Task 1 selection (700ms pulse)
  r08_di6_tsk1:
    gpio: 26
    active_high: false
    description: "Select task 1 for tightening (700ms pulse)"
    pulse_ms: 700

# =========================
# Sensors (directly connected to Master Pi 5)
# =========================
sensors:
  # Safety curtain - blocks entry to work area
  # OPEN (HIGH) = clear, no obstruction
  # CLOSE (LOW) = blocked, stop operations
  area_sensor:
    gpio: 17
    active_low: true
    description: "Safety light curtain (AREA_SENSOR)"
    pull_up: true

  # Start pedal - initiates cycle
  # OPEN (HIGH) = released
  # CLOSE (LOW) = pressed
  ped_start:
    gpio: 18
    active_low: true
    description: "Start pedal (PED_START)"
    pull_up: true

  # Cylinder UP position sensor
  # ACTIVE = cylinder is in upper position
  ger_c2_up:
    gpio: 22
    active_low: true
    description: "Cylinder UP position (GER_C2_UP)"
    pull_up: true

  # Cylinder DOWN position sensor - EMERGENCY!
  # If triggered, must turn off R04_C2 (cylinder relay)
  # ACTIVE = cylinder reached bottom (emergency condition)
  ger_c2_down:
    gpio: 23
    active_low: true
    description: "Cylinder DOWN position - EMERGENCY (GER_C2_DOWN)"
    pull_up: true

  # Inductive screw sensor - detects if screw passed through tube
  # OPEN (HIGH) = no screw
  # CLOSE (LOW) = screw passed/present
  ind_scrw:
    gpio: 12
    active_low: true
    description: "Inductive screw sensor (IND_SCRW)"
    pull_up: true

  # Driver torque OK signal
  # OPEN (HIGH) = torque not reached yet
  # CLOSE (LOW) = torque reached, screw tightened
  do2_ok:
    gpio: 25
    active_low: true
    description: "Torque reached signal (DO2_OK)"
    pull_up: true

# =========================
# Communication
# =========================
serial:
  xy_table_port: "/dev/ttyAMA0"
  xy_table_baud: 115200

# =========================
# Logic settings
# =========================
logic:
  endstop_active_low: true
  relay_active_high: false  # Relays are active_low: GPIO LOW = ON
  step_pulse_active_low: true
  step_idle_level: 1
